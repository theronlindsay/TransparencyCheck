{"version":3,"file":"_server-aUTsoZQC.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/search-bills/_server.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { i as initDatabase, f as fetchAndStoreBills } from \"../../../../chunks/index.js\";\nfunction determineBillStatus(bill) {\n  const latestActionText = bill.latestAction?.text?.toLowerCase() || \"\";\n  if (latestActionText.includes(\"became public law\") || latestActionText.includes(\"became private law\") || latestActionText.includes(\"signed by president\")) {\n    return \"Enacted\";\n  }\n  if (latestActionText.includes(\"vetoed\") || latestActionText.includes(\"veto message\")) {\n    return \"Vetoed\";\n  }\n  if (latestActionText.includes(\"failed\") || latestActionText.includes(\"rejected\") || latestActionText.includes(\"motion to proceed rejected\")) {\n    return \"Failed\";\n  }\n  if (latestActionText.includes(\"passed senate\") || latestActionText.includes(\"received in the senate\")) {\n    return \"Passed House\";\n  }\n  if (latestActionText.includes(\"passed house\") || latestActionText.includes(\"received in the house\")) {\n    return \"Passed Senate\";\n  }\n  if (latestActionText.includes(\"referred to\") || latestActionText.includes(\"committee on\")) {\n    return \"In Committee\";\n  }\n  if (latestActionText.includes(\"introduced in\") || bill.introducedDate) {\n    return \"Introduced\";\n  }\n  return \"Active\";\n}\nasync function GET({ url }) {\n  const searchQuery = url.searchParams.get(\"search\") || \"\";\n  const status = url.searchParams.get(\"status\");\n  const chamber = url.searchParams.get(\"chamber\");\n  const sponsor = url.searchParams.get(\"sponsor\");\n  const dateFrom = url.searchParams.get(\"dateFrom\");\n  const dateTo = url.searchParams.get(\"dateTo\");\n  const stream = url.searchParams.get(\"stream\") === \"true\";\n  try {\n    await initDatabase();\n    const bills = await fetchAndStoreBills({ searchQuery, dateFrom, dateTo });\n    if (stream) {\n      const readable = new ReadableStream({\n        async start(controller) {\n          const encoder = new TextEncoder();\n          let count = 0;\n          console.log(`Starting stream for ${bills.length} bills`);\n          for (const bill of bills) {\n            try {\n              const billStatus = determineBillStatus(bill);\n              const formattedBill = {\n                id: `${bill.type}${bill.number}`,\n                billNumber: `${bill.type}.${bill.number}`,\n                congress: bill.congress,\n                type: bill.type,\n                introducedDate: bill.introducedDate,\n                latestAction: bill.latestAction?.text || \"\",\n                status: billStatus,\n                originChamber: bill.originChamber,\n                originChamberCode: bill.originChamberCode,\n                title: bill.title,\n                updateDate: bill.updateDate,\n                url: bill.url,\n                policyArea: bill.policyArea?.name || \"\",\n                sponsors: bill.sponsors?.map((s) => s.fullName).join(\", \") || \"\"\n              };\n              let shouldInclude = true;\n              if (chamber && chamber !== \"all\" && formattedBill.originChamber !== chamber) {\n                shouldInclude = false;\n              }\n              if (sponsor && shouldInclude) {\n                const sponsorLower = sponsor.toLowerCase();\n                if (!formattedBill.sponsors.toLowerCase().includes(sponsorLower)) {\n                  shouldInclude = false;\n                }\n              }\n              if (status && status !== \"all\" && formattedBill.status !== status) {\n                shouldInclude = false;\n              }\n              if (shouldInclude) {\n                count++;\n                const chunk = JSON.stringify(formattedBill) + \"\\n\";\n                controller.enqueue(encoder.encode(chunk));\n                console.log(`Streamed bill ${count}: ${formattedBill.billNumber}`);\n              }\n            } catch (error) {\n              console.error(`Error processing bill ${bill.type}${bill.number}:`, error);\n            }\n          }\n          console.log(`Stream completed. Total bills streamed: ${count}`);\n          controller.close();\n        }\n      });\n      return new Response(readable, {\n        headers: {\n          \"Content-Type\": \"application/x-ndjson\",\n          \"Cache-Control\": \"no-cache\",\n          \"Connection\": \"keep-alive\"\n        }\n      });\n    }\n    const formattedBills = bills.map((bill) => {\n      const billStatus = determineBillStatus(bill);\n      return {\n        id: `${bill.type}${bill.number}`,\n        billNumber: `${bill.type}.${bill.number}`,\n        congress: bill.congress,\n        type: bill.type,\n        introducedDate: bill.introducedDate,\n        latestAction: bill.latestAction?.text || \"\",\n        status: billStatus,\n        originChamber: bill.originChamber,\n        originChamberCode: bill.originChamberCode,\n        title: bill.title,\n        updateDate: bill.updateDate,\n        url: bill.url,\n        policyArea: bill.policyArea?.name || \"\",\n        sponsors: bill.sponsors?.map((s) => s.fullName).join(\", \") || \"\"\n      };\n    });\n    let filteredBills = formattedBills;\n    if (chamber && chamber !== \"all\") {\n      filteredBills = filteredBills.filter((bill) => bill.originChamber === chamber);\n    }\n    if (sponsor) {\n      const sponsorLower = sponsor.toLowerCase();\n      filteredBills = filteredBills.filter((bill) => {\n        const sponsors = bill.sponsors || \"\";\n        return sponsors.toLowerCase().includes(sponsorLower);\n      });\n    }\n    if (status && status !== \"all\") {\n      filteredBills = filteredBills.filter((bill) => bill.status === status);\n    }\n    return json({\n      bills: filteredBills,\n      count: filteredBills.length,\n      source: \"congress.gov\"\n    });\n  } catch (error) {\n    console.error(\"Search bills error:\", error);\n    return json(\n      {\n        bills: [],\n        count: 0,\n        error: error.message\n      },\n      { status: 500 }\n    );\n  }\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;;;;AAEA,SAAS,mBAAmB,CAAC,IAAI,EAAE;AACnC,EAAE,MAAM,gBAAgB,GAAG,IAAI,CAAC,YAAY,EAAE,IAAI,EAAE,WAAW,EAAE,IAAI,EAAE;AACvE,EAAE,IAAI,gBAAgB,CAAC,QAAQ,CAAC,mBAAmB,CAAC,IAAI,gBAAgB,CAAC,QAAQ,CAAC,oBAAoB,CAAC,IAAI,gBAAgB,CAAC,QAAQ,CAAC,qBAAqB,CAAC,EAAE;AAC7J,IAAI,OAAO,SAAS;AACpB,EAAE;AACF,EAAE,IAAI,gBAAgB,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,gBAAgB,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE;AACxF,IAAI,OAAO,QAAQ;AACnB,EAAE;AACF,EAAE,IAAI,gBAAgB,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,gBAAgB,CAAC,QAAQ,CAAC,UAAU,CAAC,IAAI,gBAAgB,CAAC,QAAQ,CAAC,4BAA4B,CAAC,EAAE;AAC/I,IAAI,OAAO,QAAQ;AACnB,EAAE;AACF,EAAE,IAAI,gBAAgB,CAAC,QAAQ,CAAC,eAAe,CAAC,IAAI,gBAAgB,CAAC,QAAQ,CAAC,wBAAwB,CAAC,EAAE;AACzG,IAAI,OAAO,cAAc;AACzB,EAAE;AACF,EAAE,IAAI,gBAAgB,CAAC,QAAQ,CAAC,cAAc,CAAC,IAAI,gBAAgB,CAAC,QAAQ,CAAC,uBAAuB,CAAC,EAAE;AACvG,IAAI,OAAO,eAAe;AAC1B,EAAE;AACF,EAAE,IAAI,gBAAgB,CAAC,QAAQ,CAAC,aAAa,CAAC,IAAI,gBAAgB,CAAC,QAAQ,CAAC,cAAc,CAAC,EAAE;AAC7F,IAAI,OAAO,cAAc;AACzB,EAAE;AACF,EAAE,IAAI,gBAAgB,CAAC,QAAQ,CAAC,eAAe,CAAC,IAAI,IAAI,CAAC,cAAc,EAAE;AACzE,IAAI,OAAO,YAAY;AACvB,EAAE;AACF,EAAE,OAAO,QAAQ;AACjB;AACA,eAAe,GAAG,CAAC,EAAE,GAAG,EAAE,EAAE;AAC5B,EAAE,MAAM,WAAW,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE;AAC1D,EAAE,MAAM,MAAM,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,QAAQ,CAAC;AAC/C,EAAE,MAAM,OAAO,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,SAAS,CAAC;AACjD,EAAE,MAAM,OAAO,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,SAAS,CAAC;AACjD,EAAE,MAAM,QAAQ,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC;AACnD,EAAE,MAAM,MAAM,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,QAAQ,CAAC;AAC/C,EAAE,MAAM,MAAM,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,QAAQ,CAAC,KAAK,MAAM;AAC1D,EAAE,IAAI;AACN,IAAI,MAAM,YAAY,EAAE;AACxB,IAAI,MAAM,KAAK,GAAG,MAAM,kBAAkB,CAAC,EAAE,WAAW,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC;AAC7E,IAAI,IAAI,MAAM,EAAE;AAChB,MAAM,MAAM,QAAQ,GAAG,IAAI,cAAc,CAAC;AAC1C,QAAQ,MAAM,KAAK,CAAC,UAAU,EAAE;AAChC,UAAU,MAAM,OAAO,GAAG,IAAI,WAAW,EAAE;AAC3C,UAAU,IAAI,KAAK,GAAG,CAAC;AACvB,UAAU,OAAO,CAAC,GAAG,CAAC,CAAC,oBAAoB,EAAE,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;AAClE,UAAU,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE;AACpC,YAAY,IAAI;AAChB,cAAc,MAAM,UAAU,GAAG,mBAAmB,CAAC,IAAI,CAAC;AAC1D,cAAc,MAAM,aAAa,GAAG;AACpC,gBAAgB,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;AAChD,gBAAgB,UAAU,EAAE,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;AACzD,gBAAgB,QAAQ,EAAE,IAAI,CAAC,QAAQ;AACvC,gBAAgB,IAAI,EAAE,IAAI,CAAC,IAAI;AAC/B,gBAAgB,cAAc,EAAE,IAAI,CAAC,cAAc;AACnD,gBAAgB,YAAY,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,IAAI,EAAE;AAC3D,gBAAgB,MAAM,EAAE,UAAU;AAClC,gBAAgB,aAAa,EAAE,IAAI,CAAC,aAAa;AACjD,gBAAgB,iBAAiB,EAAE,IAAI,CAAC,iBAAiB;AACzD,gBAAgB,KAAK,EAAE,IAAI,CAAC,KAAK;AACjC,gBAAgB,UAAU,EAAE,IAAI,CAAC,UAAU;AAC3C,gBAAgB,GAAG,EAAE,IAAI,CAAC,GAAG;AAC7B,gBAAgB,UAAU,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,IAAI,EAAE;AACvD,gBAAgB,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI;AAC9E,eAAe;AACf,cAAc,IAAI,aAAa,GAAG,IAAI;AACtC,cAAc,IAAI,OAAO,IAAI,OAAO,KAAK,KAAK,IAAI,aAAa,CAAC,aAAa,KAAK,OAAO,EAAE;AAC3F,gBAAgB,aAAa,GAAG,KAAK;AACrC,cAAc;AACd,cAAc,IAAI,OAAO,IAAI,aAAa,EAAE;AAC5C,gBAAgB,MAAM,YAAY,GAAG,OAAO,CAAC,WAAW,EAAE;AAC1D,gBAAgB,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE;AAClF,kBAAkB,aAAa,GAAG,KAAK;AACvC,gBAAgB;AAChB,cAAc;AACd,cAAc,IAAI,MAAM,IAAI,MAAM,KAAK,KAAK,IAAI,aAAa,CAAC,MAAM,KAAK,MAAM,EAAE;AACjF,gBAAgB,aAAa,GAAG,KAAK;AACrC,cAAc;AACd,cAAc,IAAI,aAAa,EAAE;AACjC,gBAAgB,KAAK,EAAE;AACvB,gBAAgB,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,GAAG,IAAI;AAClE,gBAAgB,UAAU,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AACzD,gBAAgB,OAAO,CAAC,GAAG,CAAC,CAAC,cAAc,EAAE,KAAK,CAAC,EAAE,EAAE,aAAa,CAAC,UAAU,CAAC,CAAC,CAAC;AAClF,cAAc;AACd,YAAY,CAAC,CAAC,OAAO,KAAK,EAAE;AAC5B,cAAc,OAAO,CAAC,KAAK,CAAC,CAAC,sBAAsB,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC;AACvF,YAAY;AACZ,UAAU;AACV,UAAU,OAAO,CAAC,GAAG,CAAC,CAAC,wCAAwC,EAAE,KAAK,CAAC,CAAC,CAAC;AACzE,UAAU,UAAU,CAAC,KAAK,EAAE;AAC5B,QAAQ;AACR,OAAO,CAAC;AACR,MAAM,OAAO,IAAI,QAAQ,CAAC,QAAQ,EAAE;AACpC,QAAQ,OAAO,EAAE;AACjB,UAAU,cAAc,EAAE,sBAAsB;AAChD,UAAU,eAAe,EAAE,UAAU;AACrC,UAAU,YAAY,EAAE;AACxB;AACA,OAAO,CAAC;AACR,IAAI;AACJ,IAAI,MAAM,cAAc,GAAG,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,KAAK;AAC/C,MAAM,MAAM,UAAU,GAAG,mBAAmB,CAAC,IAAI,CAAC;AAClD,MAAM,OAAO;AACb,QAAQ,EAAE,EAAE,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;AACxC,QAAQ,UAAU,EAAE,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;AACjD,QAAQ,QAAQ,EAAE,IAAI,CAAC,QAAQ;AAC/B,QAAQ,IAAI,EAAE,IAAI,CAAC,IAAI;AACvB,QAAQ,cAAc,EAAE,IAAI,CAAC,cAAc;AAC3C,QAAQ,YAAY,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,IAAI,EAAE;AACnD,QAAQ,MAAM,EAAE,UAAU;AAC1B,QAAQ,aAAa,EAAE,IAAI,CAAC,aAAa;AACzC,QAAQ,iBAAiB,EAAE,IAAI,CAAC,iBAAiB;AACjD,QAAQ,KAAK,EAAE,IAAI,CAAC,KAAK;AACzB,QAAQ,UAAU,EAAE,IAAI,CAAC,UAAU;AACnC,QAAQ,GAAG,EAAE,IAAI,CAAC,GAAG;AACrB,QAAQ,UAAU,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,IAAI,EAAE;AAC/C,QAAQ,QAAQ,EAAE,IAAI,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI;AACtE,OAAO;AACP,IAAI,CAAC,CAAC;AACN,IAAI,IAAI,aAAa,GAAG,cAAc;AACtC,IAAI,IAAI,OAAO,IAAI,OAAO,KAAK,KAAK,EAAE;AACtC,MAAM,aAAa,GAAG,aAAa,CAAC,MAAM,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,aAAa,KAAK,OAAO,CAAC;AACpF,IAAI;AACJ,IAAI,IAAI,OAAO,EAAE;AACjB,MAAM,MAAM,YAAY,GAAG,OAAO,CAAC,WAAW,EAAE;AAChD,MAAM,aAAa,GAAG,aAAa,CAAC,MAAM,CAAC,CAAC,IAAI,KAAK;AACrD,QAAQ,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,IAAI,EAAE;AAC5C,QAAQ,OAAO,QAAQ,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,YAAY,CAAC;AAC5D,MAAM,CAAC,CAAC;AACR,IAAI;AACJ,IAAI,IAAI,MAAM,IAAI,MAAM,KAAK,KAAK,EAAE;AACpC,MAAM,aAAa,GAAG,aAAa,CAAC,MAAM,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,MAAM,KAAK,MAAM,CAAC;AAC5E,IAAI;AACJ,IAAI,OAAO,IAAI,CAAC;AAChB,MAAM,KAAK,EAAE,aAAa;AAC1B,MAAM,KAAK,EAAE,aAAa,CAAC,MAAM;AACjC,MAAM,MAAM,EAAE;AACd,KAAK,CAAC;AACN,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,qBAAqB,EAAE,KAAK,CAAC;AAC/C,IAAI,OAAO,IAAI;AACf,MAAM;AACN,QAAQ,KAAK,EAAE,EAAE;AACjB,QAAQ,KAAK,EAAE,CAAC;AAChB,QAAQ,KAAK,EAAE,KAAK,CAAC;AACrB,OAAO;AACP,MAAM,EAAE,MAAM,EAAE,GAAG;AACnB,KAAK;AACL,EAAE;AACF;;;;"}