{"version":3,"file":"_server-CVyfvNpQ.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/bills/_server.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { i as initDatabase, q as query } from \"../../../../chunks/index.js\";\nconst corsHeaders = {\n  \"Access-Control-Allow-Origin\": \"*\",\n  \"Access-Control-Allow-Methods\": \"GET, OPTIONS\",\n  \"Access-Control-Allow-Headers\": \"Content-Type\"\n};\nasync function OPTIONS() {\n  return new Response(null, { headers: corsHeaders });\n}\nasync function GET() {\n  try {\n    await initDatabase();\n    const billsWithData = await query(`\n\t\t\tSELECT \n\t\t\t\tb.*,\n\t\t\t\tpc.name as primaryCommitteeName,\n\t\t\t\tGROUP_CONCAT(\n\t\t\t\t\tjson_object(\n\t\t\t\t\t\t'bioguideId', p.bioguideId,\n\t\t\t\t\t\t'firstName', p.firstName,\n\t\t\t\t\t\t'lastName', p.lastName,\n\t\t\t\t\t\t'fullName', p.fullName,\n\t\t\t\t\t\t'party', p.party,\n\t\t\t\t\t\t'state', p.state,\n\t\t\t\t\t\t'district', p.district\n\t\t\t\t\t), '|||'\n\t\t\t\t) as sponsorsData,\n\t\t\t\tGROUP_CONCAT(\n\t\t\t\t\tjson_object(\n\t\t\t\t\t\t'committeeCode', c.committeeCode,\n\t\t\t\t\t\t'name', c.name,\n\t\t\t\t\t\t'chamber', c.chamber,\n\t\t\t\t\t\t'type', c.type\n\t\t\t\t\t), '|||'\n\t\t\t\t) as committeesData\n\t\t\tFROM bills b\n\t\t\tLEFT JOIN committees pc ON b.primaryCommitteeCode = pc.committeeCode\n\t\t\tLEFT JOIN bill_people bp ON b.id = bp.billId AND bp.relationship = 'sponsor'\n\t\t\tLEFT JOIN people p ON bp.personId = p.bioguideId\n\t\t\tLEFT JOIN bill_committees bc ON b.id = bc.billId\n\t\t\tLEFT JOIN committees c ON bc.committeeCode = c.committeeCode\n\t\t\tGROUP BY b.id\n\t\t\tORDER BY b.updateDate DESC\n\t\t\tLIMIT 100\n\t\t`);\n    const bills = billsWithData.map((bill) => ({\n      ...bill,\n      latestAction: bill.latestAction ? JSON.parse(bill.latestAction) : null,\n      policyArea: bill.policyArea ? JSON.parse(bill.policyArea) : null,\n      sponsors: bill.sponsorsData ? bill.sponsorsData.split(\"|||\").map((s) => JSON.parse(s)).filter((s) => s.bioguideId) : [],\n      committees: bill.committeesData ? bill.committeesData.split(\"|||\").map((c) => JSON.parse(c)).filter((c) => c.committeeCode) : []\n    }));\n    return json(bills, { headers: corsHeaders });\n  } catch (error) {\n    console.error(\"Error fetching bills:\", error);\n    return json({ error: error.message }, { status: 500, headers: corsHeaders });\n  }\n}\nexport {\n  GET,\n  OPTIONS\n};\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAM,WAAW,GAAG;AACpB,EAAE,6BAA6B,EAAE,GAAG;AACpC,EAAE,8BAA8B,EAAE,cAAc;AAChD,EAAE,8BAA8B,EAAE;AAClC,CAAC;AACD,eAAe,OAAO,GAAG;AACzB,EAAE,OAAO,IAAI,QAAQ,CAAC,IAAI,EAAE,EAAE,OAAO,EAAE,WAAW,EAAE,CAAC;AACrD;AACA,eAAe,GAAG,GAAG;AACrB,EAAE,IAAI;AACN,IAAI,MAAM,YAAY,EAAE;AACxB,IAAI,MAAM,aAAa,GAAG,MAAM,KAAK,CAAC;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,CAAC,CAAC;AACJ,IAAI,MAAM,KAAK,GAAG,aAAa,CAAC,GAAG,CAAC,CAAC,IAAI,MAAM;AAC/C,MAAM,GAAG,IAAI;AACb,MAAM,YAAY,EAAE,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,IAAI;AAC5E,MAAM,UAAU,EAAE,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,IAAI;AACtE,MAAM,QAAQ,EAAE,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,UAAU,CAAC,GAAG,EAAE;AAC7H,MAAM,UAAU,EAAE,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,aAAa,CAAC,GAAG;AACpI,KAAK,CAAC,CAAC;AACP,IAAI,OAAO,IAAI,CAAC,KAAK,EAAE,EAAE,OAAO,EAAE,WAAW,EAAE,CAAC;AAChD,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,uBAAuB,EAAE,KAAK,CAAC;AACjD,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,OAAO,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,WAAW,EAAE,CAAC;AAChF,EAAE;AACF;;;;"}