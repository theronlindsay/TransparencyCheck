# TransparencyCheck

Prototype dashboard for tracking U.S. congressional legislation across web and mobile clients. The repository now ships with an embedded SQLite database (backed by the native `sqlite3` driver at runtime) so the Next.js app acts as both the public web client and a reusable backend API for other platforms.

## Prerequisites

- Node.js 18+ (Node 22 is recommended)
- npm (bundled with Node)

## Installation

```bash
npm install
npm run db:seed
```

The seed script creates `db/transparency.sqlite` and populates it from the static fixtures in `app/data/bills.js`. You can replace the seeded rows with live data from Congress.gov using the sync workflow described below.

## Development

```bash
npm run dev
```

Open <http://localhost:3000> to browse the material-inspired bill list. The App Router queries SQLite on the server, so the UI stays fully static while benefitting from cached data.

## API Endpoints

The embedded database is exposed through lightweight JSON endpoints for consumption by React Native, web, or other clients:

- `GET /api/bills` — returns the full cached bill collection.
- `GET /api/bills/[billId]` — returns extended detail for a specific bill (404s if the bill is missing).

Responses include voting history, schedules, and news arrays—exactly what the Next.js pages consume.

## Database layout

- `db/transparency.sqlite` — SQLite database generated by the seed or sync scripts.
- `lib/sqlite.js` — opens the native `sqlite3` database file and provides helpers for both read and write queries.
- `lib/bills.js` — wraps bill-specific reads and exposes `replaceBills` for the sync workflow.

The current schema stores detailed structures (votes, schedule, news) as JSON blobs. You can evolve it into fully normalized tables once you begin storing richer metadata from the Congress.gov API.

## Syncing live bills from Congress.gov

1. [Request a Congress.gov API key](https://api.congress.gov/) if you do not already have one.
2. Create a `.env.local` file (or export the variable in your shell) with:

	```bash
	CONGRESS_API_KEY=your-api-key-here
	```

3. Run the sync script:

	```bash
	npm run db:sync -- --limit=150
	```

	- `--limit` caps how many of the most recently updated bills to cache (defaults to 100, max 250).
	- `--detail-limit` controls how many bills receive detailed summary hydration (defaults to 40).
	- `--no-detail` skips the secondary detail calls for a faster, metadata-only refresh.

The script fetches the freshest bills from Congress.gov, enriches summaries, and atomically replaces the contents of `db/transparency.sqlite`. Every consumer of `/api/bills` immediately sees the updated dataset.

## Maintenance tips

- Update `app/data/bills.js` and re-run `npm run db:seed` if you want to rebuild the database from local fixtures.
- Schedule `npm run db:sync` (GitHub Actions, Vercel Cron, Azure Functions, etc.) to keep the cache aligned with Congress.gov.
- Share the `/api` routes with native apps to keep all platforms aligned.
